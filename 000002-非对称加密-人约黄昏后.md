# 非对称加密 - 人约黄昏后

张生给崔莺莺写了一封信，“月上柳梢头，人约黄昏后”。怎么把信安全地送给崔莺莺呢？

1. 把信装进盒子
2. 用锁把盒子锁住
3. 这把锁只有崔莺莺能够打开

这就是非对称加密的起源。

1. 钥匙只有一把，由崔莺莺保管
2. 同样的锁有很多个，把它们给写信的人
3. 任何想给崔莺莺写信的人，用锁把信锁在盒子里
4. 只有崔莺莺可以开锁看信


由崔莺莺保管的这把钥匙在非对称加密中叫 私钥（Private Key），这把可以分发给很多人的锁叫 公钥 （Public Key）。


我们在传递信息时，用崔莺莺的锁（公钥）加密信息，崔莺莺收到信后，用自己的钥匙（私钥）开锁，解密信息。


> 非对称密码学（Asymmetric cryptography）的RSA加密算法由麻省理工学院的Rivest，Shamir和Adleman在1977年提出。比特币使用的非对称密码学是1985年提出的椭圆曲线密码学（Elliptic Curve Cryptography）。


> RSA 加密信息
> 崔莺莺有自己的钥匙（私钥d）和 n
> 崔莺莺有自己的锁（公钥e） 和 n
> 
> 张生用e和n加密message
> 得到encrypted message
> encrypted message = message ^ e mod n
> 加密后的信息就是 message 的 d 次方 除 n 的余数
>
> 崔莺莺用 d 和 n 解密 encrypted message
> 得到message
> message = encrypted message ^ d mod n
> message就是 encrypted message 的 d 次方 除 n 的余数


## 崔莺莺制作可以分发的锁（公钥）

```
1. 崔莺莺随机选择两个质数

p1=53
p2=59

这两个质数相乘
n=p1 x p2 
= 53 x 59 
= 3127


2. 崔莺莺随机选择一个数字
e=3


n=3127
e=3
是崔莺莺可以分发的锁（公钥，Public Key）
```


## 崔莺莺制作开锁的钥匙（私钥）

```


3. 崔莺莺进行函数运算
PHI(n)
=PHI(3127)
=3016

PHI(n)非常重要，
PHI(n)的数学性质决定
只有崔莺莺能算出PHI(n)的结果




4. 崔莺莺通过PHI(n)和e
计算用于解密的d
d= [2 x PHI(n) + 1] ÷ e
= (2 x 3016 +1) ÷ 3
= 2011

d=2011
是崔莺莺要保存好的开锁钥匙（私钥，Private Key）

```


## 约会流程
```
张生通过n和e加密
崔莺莺通过PHI(n)和e得到d，通过n和d解密

```
## 约会注意事项
```
这里的关键是PHI(n)，
虽然大家都可以看到
n=3127
e=3
但是如果不知道p1和p2,
非常难算出PHI(n),
就算用世界上最强大的计算机，
也要算很多很多年。

只有崔莺莺知道p1和p2，
所以只有她能算出PHI(n),
所以只有她能算出私钥d

```

## 张生用崔莺莺的公钥（n和e）加密信息
```
张生想把信息
m=89
送给崔莺莺

1. 张生计算 m 的 e 次方
除 n 的余数
89 的 3 次方 = 704969
704969 除 3127 的余数 = 1394

2. 张生把上了锁的数字 1394 
派人送给崔莺莺
```

## 经过加密的信息是安全的

```

1394是加密后的信息，
崔莺莺的妈妈看到后，
并不能解读里面的内容

虽然她知道
m的3次方除3127的余数是1394

但要找到这个m，需要实验很多次 

```
## 崔莺莺通过PHI(n)和e计算得出自己的私钥d，用n和d解密

> 通过PHI(n)和e计算得出d

```
崔莺莺拿到1394后，
进行运算，
用自己的钥匙（私钥，Private Key）
开锁


1. 通过PHI(n)和e计算得出d
d= [2 x PHI(n) + 1] ÷ e
= (2 x 3016 +1) ÷ 3
= 2011
2.计算1394的d次方
除n的余数

1394 的 2011 次方
除 3127

余数为89
就是张生的信息m




```


## 为什么PHI(n)只有崔莺莺能算出来

> 如果一个很大的数是由两个质数相乘得到的，要找到这两个质数，需要经过很多很多次的计算，世界上性能最强的计算机也要算很多很多年

```
回忆一下小学数学

质数（Prime Number）是除了1和自身外

不能被其他数整除的数

比如：5，7，11

```

```

因子（factor） 6= 2 x 3

2 和  3 是 6 的因子

```



```
PHI 函数

PHI(n)=比n小，
而且跟n没有共同因子的
数字的个数

对于质数5来说，
1，2，3，4这4个数字都比5小
而且这4个数字和5没有共同的因子

如果用PHI函数来表示

PHI(5)=4
```

```
对于任何质数p，
比p小，
而且和p没有共同因子的数字,
一共有 p-1 个 

如果用PHI函数来表示

PHI(p)=p-1

```



```

对于任意数字n=p1 x p2

PHI(n)=PHI(p1) x PHI(p2)

```

```
PHI(n) 
= PHI(p1)*PHI(p2)
=(p1-1) x (p2-1)
= 52 x 58 
= 3016

```



